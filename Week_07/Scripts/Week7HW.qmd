---
title: "Week7HW"
author: "Kent Glover"
date: last-modified
format: 
  html:
    self-contained: true
    toc: true
    code-fold: true
    code-summary: "Show the code"
---

## Introduction

The goal is to visualize the distribution of plastic waste collected across different countries. We will create a world map to show the total amount of plastic pollution recorded per country and a bar chart to highlight the countries with the highest recorded pollution.

## Setup

First, we need to load the necessary R packages for our analysis. We'll use `tidyverse` for data manipulation and plotting, `sf` and `rnaturalearth` for spatial data, `here` for file path management, `ggspatial` for map elements, and `patchwork` to combine our plots.

```{r}
#| label: load-packages
#| message: false
#| warning: false

library(tidyverse)
library(sf)
library(rnaturalearth)
library(rnaturalearthdata)
library(here)
library(ggspatial)
library(patchwork)
```

## Data Loading and Preparation

We'll load the `plastics.csv` dataset. The dataset contains information about plastic pollution collected during clean-up events. We will then process this data to make it suitable for mapping.

Our preparation steps are:
1.  Read the raw data.
2.  Group the data by country.
3.  Calculate the sum of `grand_total` plastic items for each country.
4.  Rename the `country` column to `name` to facilitate joining with the map data.
5.  Correct a country name from "United Kingdom of Great Britain and Northern Ireland" to "United Kingdom" for consistency.

```{r}
#| label: data-prep

# Load the plastic pollution data
plastics_raw <- read_csv(here("Week_07", "Data","plastics.csv"))

# Aggregate data to get total plastic per country
plastic_by_country <- plastics_raw %>%
  filter(year == 2020) %>% # Focusing on the most recent year for consistency
  group_by(country) %>%
  summarise(total_plastic = sum(grand_total, na.rm = TRUE)) %>%
  ungroup() %>%
  mutate(name = country) %>% 
  # Standardize country name for joining with map data
  mutate(name = case_when(
    name == "United Kingdom of Great Britain and Northern Ireland" ~ "United Kingdom",
    TRUE ~ name
  ))
```

## Creating the World Map

Now, we will create the choropleth map.

1.  We obtain world map spatial data using the `ne_countries` function from the `rnaturalearth` package.
2.  We perform a left join to merge our aggregated plastic pollution data with the world map data based on country names.

```{r}
#| label: create-map-data

# Get world map data
world <- ne_countries(scale = "medium", returnclass = "sf")

# Join plastic data with world map data
world_plastics <- world %>%
  left_join(plastic_by_country, by = "name")
```

With the data merged, we can now plot the map using `ggplot2`. We will use a color scale to represent the amount of plastic pollution.

```{r}
#| label: plot-map
#| fig-cap: "World map showing total plastic items collected in 2020."
#| warning: false

map_plot <- ggplot(data = world_plastics) +
  geom_sf(aes(fill = total_plastic), color = "black", size = 0.2) +
  scale_fill_viridis_c(
    option = "plasma", 
    na.value = "grey90", 
    trans = "log10",
    name = "Total Plastic Items (log scale)",
    guide = guide_colorbar(
      direction = "horizontal",
      barwidth = 15,
      barheight = 0.5,
      title.position = "top",
      title.hjust = 0.5
    )
  ) +
  labs(
    title = "Global Plastic Pollution by Country (2020)",
    subtitle = "Total plastic items collected during clean-up events",
    caption = "Source: Tidy Tuesday | #BreakFreeFromPlastic"
  ) +
  theme_void() +
  theme(
    legend.position = "bottom",
    plot.title = element_text(hjust = 0.5, face = "bold", size = 16),
    plot.subtitle = element_text(hjust = 0.5, size = 12),
    plot.caption = element_text(hjust = 0.5, size = 8),
    plot.background = element_rect(fill = "white", color = NA)
  ) +
  annotation_scale(location = "bl", width_hint = 0.2) +
  annotation_north_arrow(location = "tl", which_north = "true", 
                         style = north_arrow_fancy_orienteering)
```

## Top 10 Polluting Countries

To provide another perspective, let's visualize the top 10 countries with the most plastic pollution recorded.

```{r}
#| label: bar-chart
#| fig-cap: "Top 10 countries by total plastic items collected."

# Create a bar chart for the top 10 countries
top_10_plot <- plastic_by_country %>%
  arrange(desc(total_plastic)) %>%
  slice_head(n = 10) %>%
  ggplot(aes(x = reorder(country, total_plastic), y = total_plastic)) +
  geom_col(fill = "skyblue", color = "black") +
  coord_flip() +
  labs(
    title = "Top 10 Countries",
    x = "",
    y = "Total Plastic Items"
  ) +
  theme_minimal() +
    theme(
    plot.title = element_text(hjust = 0.5, face = "bold")
  )
```

## Combined View

Finally, we can combine our map and the bar chart into a single, comprehensive visualization using the `patchwork` package. This allows for a better understanding of both the geographic distribution and the ranking of countries by plastic pollution.

```{r}
#| label: combined-plot
#| fig-cap: "Global plastic pollution map and top 10 countries."
#| fig-width: 12
#| fig-height: 7

# Combine the plots
combined_plot <- map_plot + top_10_plot +
  plot_layout(widths = c(3, 1))

# Display the combined plot
combined_plot
```

## Conclusion

The map reveals that plastic pollution is a global issue, with data reported from countries across every continent. The bar chart further highlights that a few countries report significantly higher amounts of collected plastic waste. This visualization serves as a powerful tool to understand the scale and distribution of the plastic pollution problem based on the collected data. For a more comprehensive analysis, data from more years and more locations would be beneficial.
