---
title: "Week 6 Homework"
author: "Kent Glover"
date: "today"
format: gfm
prefer-html: true
---

## Introduction

This report takes a look at the site characteristics from Dr. Silbiger's dataset on the coral reefs of Mo'orea. The main goal here is to whip up a publication-quality figure and table to complete the Week 6 Homework objectives!

---

## 1. Getting Started: Packages and Data

First, load up the R packages needed. **`tidyverse`** is for data wrangling and plotting, **`here`** helps keep file paths easy, **`kableExtra`** helps with tables, and **`ggrepel`** will keep plot labels from overlapping.

```{r}
#| label: load-packages
#| message: false
#| warning: false

library(tidyverse)
library(here)
library(kableExtra)
library(ggrepel)
```

With the packages loaded, now to pull in the `site.characteristics.data.csv` data and take a peek with `glimpse()` to make sure everything looks right.

```{r}
#| label: load-data

#Read the data using the here()
moorea_data <- read_csv(here("Week_05", "Data", "site.characteristics.data.csv"))

#Look at the data
glimpse(moorea_data)
```

---

## 2. Reshaping the Data

The dataset is currently in a "long" format. I'll reshape it into a "wide" format, where each row is a unique site and each measurement gets its own column. For this analysis, I'm only grabbing the columns for **`coral.cover`**, **`NH4`**, and **`temp`**.

```{r}
#| label: wrangle-data

#Filter for the parameters needed, then pivot to a wide format
wide_data <- moorea_data %>%
  filter(parameter.measured %in% c("coral.cover", "NH4", "temp")) %>%
  pivot_wider(names_from = parameter.measured, values_from = values) %>%
  select(name, coral.cover, NH4, temp) # Reorder for clarity

#Check it
wide_data
```

---

## 3. Figure: Coral Cover vs. Ammonia

Is there a visual connection between coral cover and ammonia? I'll put `NH4` on the x-axis, `coral.cover` on the y-axis of a scatterplot, and label each point with its site name.

```{r}
#| label: fig-coral-nh4
#| fig-cap: "A scatter plot exploring the link between percent coral cover and ammonia (NH4) concentration across six sites in Mo'orea. Points are colored by the site's average temperature."
#| fig-align: "center"
#| out-width: "80%"

ggplot(wide_data, aes(x = NH4, y = coral.cover)) +
  geom_point(aes(color = temp), size = 5, alpha = 0.8) +
  #Was having issues with overlapping text so using geom_text_repel to make sure labels don't overlap
  geom_text_repel(aes(label = name), 
                  fontface = "italic", 
                  box.padding = 0.5, 
                  max.overlaps = Inf,
                  segment.color = NA) + #hides the lines connecting labels to points that I thought were unnecessary
  #Tweak the legend and expand the plot area to prevent cutoff
  scale_color_viridis_c(option = "plasma", breaks = c(26.5, 27.0, 27.5)) + 
  coord_cartesian(clip = "off") + #labels can sit outside the main plot
  labs(
    title = "Coral Cover Appears Higher at Sites with Lower Ammonia",
    subtitle = "Data from six sites on the north shore of Mo'orea",
    x = "Ammonia Concentration (μM)",
    y = "Percent Coral Cover",
    color = "Temp (°C)"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    plot.title = element_text(face = "bold", size = 16),
    legend.position = "bottom",
    #Was still having problems so added some breathing room around the plot for labels
    plot.margin = margin(1, 1, 1, 1, "cm") 
  )
```

---

## 4. Table: A Quick Site Summary

Using `kableExtra`, I can lay out the key stats for each site. To draw attention to the site with the most coral, I highlighted the **Hilton High** row.

```{r}
#| label: tbl-site-summary
#| tbl-cap: "A summary table of percent coral cover, ammonia (NH4) concentration, and temperature for the six study sites in Mo'orea."

wide_data %>%
  #Sort the data to bring the site with the highest coral cover to the top
  arrange(desc(coral.cover)) %>% 
  
  #build the table with kable
  kbl(
    col.names = c("Site Name", "Coral Cover (%)", "Ammonia (μM)", "Temperature (°C)"),
    align = "lccc",
    caption = "Site Data Summary"
  ) %>%
  
  #Add styling
  kable_styling(bootstrap_options = c("striped", "hover"), full_width = FALSE) %>%
  
  #Highlight the first row
  row_spec(1, bold = TRUE, color = "white", background = "#4E79A7") 
```

---

## Conclusion

Both the plot and the table give a pretty clear picture of the Mo'orea data. Looking at **@fig-coral-nh4**, it seems like there's a trend where lower ammonia levels are found at sites with more coral. **Hilton High**, which stands out in **@tbl-site-summary** with the highest coral cover, also has one of the lowest ammonia concentrations. This shows that nutrient levels might be playing a significant role in the reef's health. This reminds me of how much nutrient levels matter in reef aquariums, but instead of doing a water change on my tanks I did this Homework :)